<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>水溶液と電流 シミュレーション</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    background: #f5f5f5;
  }
  select, button {
    font-size: 16px;
    margin: 6px;
    padding: 6px;
  }
</style>
</head>

<body>

<h2>水溶液と電流のシミュレーション</h2>

<!-- 操作UI -->
<select id="solution" onchange="updateSolution()">
  <option value="nacl">塩化ナトリウム（食塩）水溶液</option>
  <option value="hcl">塩化水素（水溶液）</option>
  <option value="naoh">水酸化ナトリウム水溶液</option>
  <option value="cucl2">塩化銅(Ⅱ)水溶液</option>
  <option value="water">水</option>
  <option value="ethanol">エタノール</option>
</select>

<select id="state" onchange="changeState()">
  <option value="solution">水溶液</option>
  <option value="solid">固体</option>
</select>

<br>
<button onclick="togglePower()">電流 ON / OFF</button>

<!-- 回路＆ビーカー -->
<svg width="640" height="520" viewBox="0 0 640 520">

  <!-- 電池 -->
  <line x1="60" y1="80" x2="60" y2="160" stroke="black" stroke-width="4"/>
  <line x1="80" y1="70" x2="80" y2="170" stroke="black" stroke-width="2"/>
  <text x="40" y="50">電池</text>
  <text x="45" y="75">＋</text>
  <text x="45" y="170">−</text>

  <!-- 電池 → 豆電球 -->
  <line x1="80" y1="80" x2="260" y2="80" stroke="black" stroke-width="2"/>

  <!-- 豆電球 -->
  <circle id="bulb" cx="300" cy="80" r="22" fill="#eee" stroke="black"/>
  <line x1="290" y1="80" x2="310" y2="80" stroke="orange" stroke-width="4"/>
  <text x="270" y="40">豆電球</text>

  <!-- 豆電球 → 右電極 -->
  <line x1="322" y1="80" x2="500" y2="80" stroke="black" stroke-width="2"/>
  <line x1="500" y1="80" x2="500" y2="210" stroke="black" stroke-width="2"/>

  <!-- ビーカー -->
  <path d="M180 210 L420 210 L390 440 Q300 470 210 440 Z"
        fill="none" stroke="#333" stroke-width="4"/>

  <!-- 水 -->
  <rect id="water" x="200" y="230" width="200" height="180"
        fill="#cceeff" opacity="0.6"/>

  <!-- 電極 -->
  <line x1="260" y1="220" x2="260" y2="390" stroke="black" stroke-width="6"/>
  <line x1="360" y1="220" x2="360" y2="390" stroke="black" stroke-width="6"/>

  <text x="235" y="200" fill="red">陽極</text>
  <text x="350" y="200" fill="blue">陰極</text>

  <!-- 左電極 → 電池 -->
  <line x1="260" y1="220" x2="260" y2="160" stroke="black" stroke-width="2"/>
  <line x1="260" y1="160" x2="60" y2="160" stroke="black" stroke-width="2"/>

  <!-- アニメーション用レイヤー -->
  <g id="bubble-layer"></g>
  <g id="cu-layer"></g>

</svg>

<script>
let powerOn = false;
let conductive = true;
let bubbleTimer = null;
let cuTimer = null;

function updateSolution() {
  const sol = document.getElementById("solution").value;
  conductive = ["nacl", "hcl", "naoh", "cucl2"].includes(sol);
  clearEffects();
  document.getElementById("bulb").setAttribute("fill", "#eee");
}

function changeState() {
  const state = document.getElementById("state").value;
  const water = document.getElementById("water");

  if (state === "solid") {
    water.style.display = "none";
    clearEffects();
    document.getElementById("bulb").setAttribute("fill", "#eee");
  } else {
    water.style.display = "block";
  }
}

function togglePower() {
  powerOn = !powerOn;
  const bulb = document.getElementById("bulb");
  const sol = document.getElementById("solution").value;

  if (powerOn && conductive && document.getElementById("state").value === "solution") {
    bulb.setAttribute("fill", "yellow");
    startBubbles();
    if (sol === "cucl2") startCuDeposition();
  } else {
    bulb.setAttribute("fill", "#eee");
    clearEffects();
  }
}

function startBubbles() {
  const layer = document.getElementById("bubble-layer");
  bubbleTimer = setInterval(() => {
    const b = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    b.setAttribute("cx", 260 + Math.random() * 10 - 5);
    b.setAttribute("cy", 380);
    b.setAttribute("r", 4);
    b.setAttribute("fill", "none");
    b.setAttribute("stroke", "#88ccff");
    layer.appendChild(b);

    let y = 380;
    const rise = setInterval(() => {
      y -= 2;
      b.setAttribute("cy", y);
      if (y < 240) {
        clearInterval(rise);
        layer.removeChild(b);
      }
    }, 30);
  }, 600);
}

function startCuDeposition() {
  const layer = document.getElementById("cu-layer");
  cuTimer = setInterval(() => {
    const d = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    d.setAttribute("cx", 360 + Math.random() * 8 - 4);
    d.setAttribute("cy", 300 + Math.random() * 60 - 30);
    d.setAttribute("r", 3);
    d.setAttribute("fill", "#b87333");
    layer.appendChild(d);
  }, 500);
}

function clearEffects() {
  clearInterval(bubbleTimer);
  clearInterval(cuTimer);
  document.getElementById("bubble-layer").innerHTML = "";
  document.getElementById("cu-layer").innerHTML = "";
}
</script>

</body>
</html>
