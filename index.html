<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>水溶液と電流 模擬実験</title>

<style>
body {
  font-family: sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:10px;
}
h2 { text-align:center; }

.controls {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  margin-bottom:10px;
}

button, select, input {
  font-size:16px;
  padding:6px;
}

#powerBtn.on { background:#ffcccc; }
#powerBtn.off { background:#ddd; }

svg { max-width:360px; display:block; margin:auto; }

#explanation {
  display:none;
  background:#fff;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  font-size:14px;
}
</style>
</head>

<body>

<h2>水溶液と電流（模擬実験）</h2>

<div class="controls">
  <select id="substance">
    <option value="sugar">砂糖</option>
    <option value="salt">塩化ナトリウム</option>
    <option value="acid">塩化水素</option>
    <option value="base">水酸化ナトリウム</option>
    <option value="copper">塩化銅</option>
    <option value="water">水</option>
    <option value="ethanol">エタノール</option>
  </select>

  <select id="state">
    <option value="solid">固体</option>
    <option value="solution">水溶液</option>
  </select>

  <button id="powerBtn" class="off">電流：OFF</button>

  <label>
    粒子数
    <input type="range" id="particleSlider" min="0" max="20" value="10">
  </label>

  <button onclick="toggleLabels()">電極表示切替</button>
  <button onclick="toggleExplanation()">教材解説</button>
</div>

<!-- ===== 回路＋ビーカー ===== -->
<svg viewBox="0 0 400 520">

<!-- 電池 -->
<line x1="50" y1="40" x2="50" y2="90" stroke="black" stroke-width="3"/>
<line x1="65" y1="30" x2="65" y2="100" stroke="black" stroke-width="5"/>
<text x="40" y="20">電池</text>

<!-- 導線（直列） -->
<path d="M65 65 H180" stroke="black" fill="none"/>
<path d="M220 65 H350 V200 H260 V300" stroke="black" fill="none"/>
<path d="M140 300 V200 H50 V65" stroke="black" fill="none"/>

<!-- 豆電球 -->
<circle id="bulbGlass" cx="200" cy="65" r="20"
        fill="yellow" opacity="0.2"/>
<line x1="190" y1="65" x2="210" y2="65"
      stroke="orange" stroke-width="4"/>
<text x="170" y="30">豆電球</text>

<!-- 電極 -->
<line x1="140" y1="200" x2="140" y2="300" stroke="black" stroke-width="4"/>
<line x1="260" y1="200" x2="260" y2="300" stroke="black" stroke-width="4"/>

<text id="labelLeft"  x="120" y="215" fill="red">＋</text>
<text id="labelRight" x="280" y="215" fill="blue">−</text>

<!-- ビーカー -->
<path d="M100 200 L300 200 L280 480 Q200 510 120 480 Z"
      fill="none" stroke="#333" stroke-width="4"/>

<!-- 水 -->
<path id="liquid"
      d="M120 260 L280 260 L260 470 Q200 490 140 470 Z"
      fill="#ccecff" opacity="0.7"/>

<!-- 粒子・析出・気泡 -->
<g id="particles"></g>
<g id="copperDeposit"></g>
<g id="bubbles"></g>

</svg>

<div id="explanation">
<b>教材解説</b><br>
・水溶液の中では、物質が粒子（イオン）として動くことで電流が流れる。<br>
・砂糖やエタノールは粒子に分かれないため、電気を通さない。<br>
・電流が流れると、電極では物質が変化し、金属の析出や気体の発生が起こる。<br>
・粒子数を増やすと、電流が流れやすくなり、豆電球が明るくなる。
</div>

<script>
const powerBtn = document.getElementById("powerBtn");
const bulb = document.getElementById("bulbGlass");
const particlesG = document.getElementById("particles");
const copperG = document.getElementById("copperDeposit");
const bubblesG = document.getElementById("bubbles");
const liquid = document.getElementById("liquid");
const slider = document.getElementById("particleSlider");
const substance = document.getElementById("substance");
const state = document.getElementById("state");

let powerOn=false;
let labelMode=0; // 0:+- 1:陽極陰極

powerBtn.onclick=()=>{
  powerOn=!powerOn;
  powerBtn.textContent=powerOn?"電流：ON":"電流：OFF";
  powerBtn.className=powerOn?"on":"off";
  draw();
};

function conducts(){
  if(state.value!=="solution") return false;
  return ["salt","acid","base","copper"].includes(substance.value) && powerOn;
}

function toggleLabels(){
  labelMode=1-labelMode;
  document.getElementById("labelLeft").textContent =
    labelMode ? "陽極" : "＋";
  document.getElementById("labelRight").textContent =
    labelMode ? "陰極" : "−";
}

function toggleExplanation(){
  const e=document.getElementById("explanation");
  e.style.display = e.style.display==="none"?"block":"none";
}

function draw(){
  particlesG.innerHTML="";
  copperG.innerHTML="";
  bubblesG.innerHTML="";
  liquid.style.display = state.value==="solution"?"block":"none";

  const cond=conducts();
  bulb.style.opacity = cond ? 0.3 + slider.value/20*0.6 : 0.2;

  for(let i=0;i<slider.value;i++){
    const p=document.createElementNS("http://www.w3.org/2000/svg","circle");
    p.setAttribute("cx",150+Math.random()*100);
    p.setAttribute("cy",300+Math.random()*120);
    p.setAttribute("r",5);
    p.setAttribute("fill",cond?(i%2?"red":"blue"):"gray");
    particlesG.appendChild(p);
  }

  if(cond){
    // 気泡（陽極）
    for(let i=0;i<5;i++){
      const b=document.createElementNS("http://www.w3.org/2000/svg","circle");
      b.setAttribute("cx",140+Math.random()*6);
      b.setAttribute("cy",300+Math.random()*120);
      b.setAttribute("r",4);
      b.setAttribute("fill","none");
      b.setAttribute("stroke","#88ccff");
      bubblesG.appendChild(b);
    }
  }

  if(cond && substance.value==="copper"){
    for(let i=0;i<10;i++){
      const cu=document.createElementNS("http://www.w3.org/2000/svg","circle");
      cu.setAttribute("cx",260+Math.random()*6);
      cu.setAttribute("cy",330+Math.random()*120);
      cu.setAttribute("r",4);
      cu.setAttribute("fill","#b87333");
      copperG.appendChild(cu);
    }
  }
}

slider.oninput=draw;
substance.onchange=draw;
state.onchange=draw;
draw();
</script>

</body>
</html>
