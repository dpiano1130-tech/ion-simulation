<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>水溶液と電流 模擬実験</title>

<style>
body {
  font-family: sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:10px;
}
h2 { text-align:center; }

.controls {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  margin-bottom:10px;
}

button, select, input {
  font-size:16px;
  padding:6px;
}

#powerBtn.on { background:#ffcccc; }
#powerBtn.off { background:#ddd; }

svg { max-width:360px; display:block; margin:auto; }

.hidden { display:none; }
</style>
</head>

<body>

<h2>水溶液と電流（模擬実験）</h2>

<div class="controls">
  <select id="substance">
    <option value="sugar">砂糖</option>
    <option value="salt">食塩</option>
    <option value="acid">塩酸</option>
    <option value="copper">塩化銅</option>
  </select>

  <select id="state">
    <option value="solid">固体</option>
    <option value="solution">水溶液</option>
  </select>

  <button id="powerBtn" class="off">電流：OFF</button>

  <label>
    粒子数
    <input type="range" id="particleSlider" min="0" max="20" value="10">
  </label>

  <button id="electrodeBtn">表示：＋ / −</button>
</div>

<!-- ===== 回路＋ビーカー ===== -->
<svg viewBox="0 0 400 500">

<!-- 電池 -->
<line x1="50" y1="50" x2="50" y2="90" stroke="black" stroke-width="3"/>
<line x1="65" y1="40" x2="65" y2="100" stroke="black" stroke-width="5"/>
<text x="40" y="35">電池</text>

<!-- 導線 -->
<path d="M65 70 H180" stroke="black" fill="none"/>

<!-- 豆電球 -->
<circle id="bulbGlass" cx="230" cy="70" r="25"
        fill="yellow" opacity="0.2"/>
<line x1="215" y1="80" x2="245" y2="80"
      stroke="orange" stroke-width="4"/>
<text x="210" y="30">豆電球</text>

<path d="M255 70 H350 V140" stroke="black" fill="none"/>

<!-- 電極 -->
<line x1="140" y1="140" x2="140" y2="200" stroke="black" stroke-width="3"/>
<line x1="260" y1="140" x2="260" y2="200" stroke="black" stroke-width="3"/>

<!-- ラベル -->
<text id="leftLabel"  x="120" y="160" fill="red">＋</text>
<text id="rightLabel" x="280" y="160" fill="blue">−</text>

<!-- ビーカー -->
<path d="M100 200 L300 200 L280 450 Q200 480 120 450 Z"
      fill="none" stroke="#333" stroke-width="4"/>

<!-- 水 -->
<path id="liquid"
      d="M120 260 L280 260 L260 440 Q200 460 140 440 Z"
      fill="#ccecff" opacity="0.7"/>

<!-- 粒子 -->
<g id="particles"></g>

<!-- Cu析出 -->
<g id="copperDeposit"></g>

</svg>

<script>
const powerBtn = document.getElementById("powerBtn");
const bulb = document.getElementById("bulbGlass");
const particlesG = document.getElementById("particles");
const copperG = document.getElementById("copperDeposit");
const liquid = document.getElementById("liquid");
const slider = document.getElementById("particleSlider");

const leftLabel  = document.getElementById("leftLabel");
const rightLabel = document.getElementById("rightLabel");
const electrodeBtn = document.getElementById("electrodeBtn");

let powerOn=false;
let labelMode="pm";

powerBtn.onclick=()=>{
  powerOn=!powerOn;
  powerBtn.textContent=powerOn?"電流：ON":"電流：OFF";
  powerBtn.className=powerOn?"on":"off";
  draw();
};

electrodeBtn.onclick=()=>{
  if(labelMode==="pm"){
    labelMode="anode";
    leftLabel.textContent="陽極";
    rightLabel.textContent="陰極";
    electrodeBtn.textContent="表示：陽極 / 陰極";
  }else{
    labelMode="pm";
    leftLabel.textContent="＋";
    rightLabel.textContent="−";
    electrodeBtn.textContent="表示：＋ / −";
  }
};

function conducts(){
  const sub=substance.value;
  const st=state.value;
  return powerOn && st==="solution" && sub!=="sugar";
}

function updateBulb(){
  bulb.style.opacity = conducts()
    ? 0.3 + slider.value/20*0.6
    : 0.2;
}

function draw(){
  particlesG.innerHTML="";
  copperG.innerHTML="";
  liquid.style.display = state.value==="solution" ? "block" : "none";

  const n=slider.value;
  const cond=conducts();

  for(let i=0;i<n;i++){
    const cx=150+Math.random()*100;
    const cy=280+Math.random()*120;
    const p=document.createElementNS("http://www.w3.org/2000/svg","circle");
    p.setAttribute("cx",cx);
    p.setAttribute("cy",cy);
    p.setAttribute("r",5);

    let color="gray";
    if(cond){
      if(substance.value==="acid") color=i%2?"red":"blue";
      else color=i%2?"red":"blue";
    }
    p.setAttribute("fill",color);

    if(cond){
      const dir=i%2?1:-1;
      let x=cx;
      setInterval(()=>{
        x+=dir*0.4;
        p.setAttribute("cx",x);
      },50);
    }
    particlesG.appendChild(p);
  }

  if(cond && substance.value==="copper"){
    for(let i=0;i<8;i++){
      const cu=document.createElementNS("http://www.w3.org/2000/svg","circle");
      cu.setAttribute("cx",250+Math.random()*10);
      cu.setAttribute("cy",350+Math.random()*60);
      cu.setAttribute("r",4);
      cu.setAttribute("fill","#b87333");
      copperG.appendChild(cu);
    }
  }

  updateBulb();
}

slider.oninput=draw;
substance.onchange=draw;
state.onchange=draw;

draw();
</script>

</body>
</html>
