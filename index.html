<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>水溶液と電流 模擬実験</title>

<style>
body {
  font-family: sans-serif;
  background:#f5f5f5;
  margin:0;
  padding:10px;
}
h2 { text-align:center; }

.controls {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  margin-bottom:10px;
}

button, select, input {
  font-size:16px;
  padding:6px;
}

#powerBtn.on { background:#ffcccc; }
#powerBtn.off { background:#ddd; }

svg { max-width:360px; display:block; margin:auto; }
</style>
</head>

<body>

<h2>水溶液と電流（模擬実験）</h2>

<div class="controls">
  <select id="substance">
    <option value="sugar">砂糖</option>
    <option value="salt">食塩</option>
    <option value="acid">塩酸</option>
    <option value="copper">塩化銅</option>
  </select>

  <select id="state">
    <option value="solid">固体</option>
    <option value="solution">水溶液</option>
  </select>

  <button id="powerBtn" class="off">電流：OFF</button>

  <label>
    粒子数
    <input type="range" id="particleSlider" min="0" max="20" value="10">
  </label>
</div>

<!-- ===== 回路＋ビーカー ===== -->
<svg viewBox="0 0 400 520">

<!-- 電池 -->
<line x1="50" y1="40" x2="50" y2="90" stroke="black" stroke-width="3"/>
<line x1="65" y1="30" x2="65" y2="100" stroke="black" stroke-width="5"/>
<text x="40" y="20">電池</text>

<!-- 導線（閉回路） -->
<path d="
M65 65
H200
V120
H140
V200
" stroke="black" fill="none"/>

<path d="
M260 200
V120
H350
V65
H50
" stroke="black" fill="none"/>

<!-- 豆電球 -->
<circle id="bulbGlass" cx="200" cy="65" r="20"
        fill="yellow" opacity="0.2"/>
<line x1="190" y1="75" x2="210" y2="75"
      stroke="orange" stroke-width="4"/>
<text x="170" y="30">豆電球</text>

<!-- 電極（溶液中まで挿入） -->
<line x1="140" y1="200" x2="140" y2="300" stroke="black" stroke-width="4"/>
<line x1="260" y1="200" x2="260" y2="300" stroke="black" stroke-width="4"/>

<text x="120" y="215" fill="red">＋</text>
<text x="280" y="215" fill="blue">−</text>

<!-- ビーカー -->
<path d="M100 200 L300 200 L280 480 Q200 510 120 480 Z"
      fill="none" stroke="#333" stroke-width="4"/>

<!-- 水 -->
<path id="liquid"
      d="M120 260 L280 260 L260 470 Q200 490 140 470 Z"
      fill="#ccecff" opacity="0.7"/>

<!-- 粒子 -->
<g id="particles"></g>

<!-- Cu析出（陰極表面） -->
<g id="copperDeposit"></g>

</svg>

<script>
const powerBtn = document.getElementById("powerBtn");
const bulb = document.getElementById("bulbGlass");
const particlesG = document.getElementById("particles");
const copperG = document.getElementById("copperDeposit");
const liquid = document.getElementById("liquid");
const slider = document.getElementById("particleSlider");

let powerOn=false;

powerBtn.onclick=()=>{
  powerOn=!powerOn;
  powerBtn.textContent=powerOn?"電流：ON":"電流：OFF";
  powerBtn.className=powerOn?"on":"off";
  draw();
};

function conducts(){
  return powerOn &&
    state.value==="solution" &&
    substance.value!=="sugar";
}

function updateBulb(){
  bulb.style.opacity = conducts()
    ? 0.3 + slider.value/20*0.6
    : 0.2;
}

function draw(){
  particlesG.innerHTML="";
  copperG.innerHTML="";
  liquid.style.display = state.value==="solution" ? "block" : "none";

  const n=slider.value;
  const cond=conducts();

  for(let i=0;i<n;i++){
    const cx=150+Math.random()*100;
    const cy=300+Math.random()*120;
    const p=document.createElementNS("http://www.w3.org/2000/svg","circle");
    p.setAttribute("cx",cx);
    p.setAttribute("cy",cy);
    p.setAttribute("r",5);
    p.setAttribute("fill",cond?(i%2?"red":"blue"):"gray");

    if(cond){
      const dir=i%2?1:-1;
      let x=cx;
      setInterval(()=>{
        x+=dir*0.4;
        p.setAttribute("cx",x);
      },50);
    }
    particlesG.appendChild(p);
  }

  // 塩化銅：陰極表面にCu析出
  if(cond && substance.value==="copper"){
    for(let i=0;i<10;i++){
      const cu=document.createElementNS("http://www.w3.org/2000/svg","circle");
      cu.setAttribute("cx",260 + Math.random()*6);
      cu.setAttribute("cy",330 + Math.random()*120);
      cu.setAttribute("r",4);
      cu.setAttribute("fill","#b87333");
      copperG.appendChild(cu);
    }
  }

  updateBulb();
}

slider.oninput=draw;
substance.onchange=draw;
state.onchange=draw;

draw();
</script>

</body>
</html>
